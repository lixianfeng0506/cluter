# cluter

redis 3.0 + 正式开始支持集群。

# redis 集群介绍

1. 集群是一个提供在多个Redis间节点间共享数据的程序集。

2. redis不支持处理多个keys的命令，因为这需要在不同节点间移动数据，从而不像redis那样的性能，在搞负载的情况下可能会导致不可预料的错误

3. redis集群通过分区来提供一定程度可用性，在实际环境中档某个节点宕机或不可达的情况下继续处理命令，redis集群的优势。

自动分割数据到不同的节点上。

整个集群的部分节点失败或者不可达情况下能够继续处理命令。

# redis 集群的数据分片

redis 集群没有使用一致的hash，而是引入了哈希槽的概念。

Redis 集群有16384个哈希槽,每个key通过CRC16校验后对16384取模来决定放置哪个槽.集群的每个节点负责一部分hash槽,举个例子,比如当前集群有3个节点,那么:

节点 A 包含 0 到 5500号哈希槽.

节点 B 包含5501 到 11000 号哈希槽.

节点 C 包含11001 到 16384号哈希槽.

# Redis 集群的主从复制模型

为了使几点失败或不可用的情况，集群使用了主从复制模型，每个节点都会有n-1个复制品。当节点及从节点都失败，集群不可用。

# redis 一致性

不能保证强一致性，意味这在实际集群中有可能会丢失数据。

第一个原因，集群是用了异步复制，写操作过程。客户端向节点b写入一条命令，节点b向客户端复制命令状态，主节点向写操作复制给其他从节点。

# 搭建并使用Redis集群

下面是一个最少选项的集群的配置文件:

port 7000
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
appendonly yes





# Redis 集群规范
1. Redis 集群的目标  

Redis 集群是 Redis 的一个分布式实现，主要是为了实现以下这些目标（按在设计中的重要性排序）：
*在1000个节点的时候仍能表现得很好并且可扩展性（scalability）是线性的。
*没有合并操作，这样在 Redis 的数据模型中最典型的大数据值中也能有很好的表现。
*写入安全（Write safety）：那些与大多数节点相连的客户端所做的写入操作，系统尝试全部都保存下来。不过公认的，还是会有小部分（small windows?）写入会丢失
*可用性（Availability）：在绝大多数的主节点（master node）是可达的，并且对于每一个不可达的主节点都至少有一个它的从节点（slave）可达的情况下，Redis 集群仍能进行分区（partitions）操作


